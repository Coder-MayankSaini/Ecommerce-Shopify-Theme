{% comment %}
  Fake Reviews Data and Logic
  Prioritizes Metafield data (custom.fake_reviews), falls back to random generation.
{% endcomment %}

{% assign reviews_metafield = product.metafields.custom.fake_reviews.value %}
{% assign use_metafield = false %}

{% if reviews_metafield != blank and reviews_metafield.size > 0 %}
  {% assign use_metafield = true %}
  {% assign total_rating = 0.0 %}
  {% assign review_count = reviews_metafield.size %}
  
  {% for review in reviews_metafield %}
    {% assign total_rating = total_rating | plus: review.rating %}
  {% endfor %}
  
  {% assign rating_score = total_rating | divided_by: review_count | round: 1 %}
{% else %}
  {% comment %} Fallback Data {% endcomment %}
  {% assign names_string = "Priya Sharma,Rahul Verma,Sneha Gupta,Amit Patel,Anjali Singh,Vikram Malhotra,Pooja Reddy,Karan Mehta,Neha Kapoor,Aditya Joshi,Riya Jain,Manish Kumar,Tanvi Saxena,Rohan Das,Isha Agarwal,Deepak Mishra,Meera Nair,Arjun Rao,Sonal Chauhan,Varun Bhatia" %}
  {% assign names = names_string | split: "," %}
  
  {% assign titles_string = "Great product!,Loved it,Amazing quality,Worth the money,Fantastic,Highly recommended,Good buy,Very satisfied,Exceeded expectations,Nice but...,Perfect gift,Impressed,Quality could be better,Fast shipping,Beautiful,Just what I wanted,Will buy again,Decent,Five stars,So happy" %}
  {% assign titles = titles_string | split: "," %}
  
  {% assign bodies_string = "Absolutely love this customized product! The quality is amazing and the engraving is exactly what I wanted. It arrived faster than expected too. Highly recommend!|Bought this as a gift for my wife and she was thrilled. The personalization adds such a special touch. Great customer service as well when I had a question about the font.|Better than I expected. The wood finish is beautiful and smooth. It looks very premium. Will definitely be ordering more for the holidays.|Really nice product. The shipping took a day longer than tracking said, but the product itself is perfect.|I was a bit skeptical at first, but the quality blew me away. The customization is very precise.|The product is good, but the packaging was a bit damaged. Luckily the item was safe.|Amazing craftsmanship. You can tell they put effort into making these. A+ service.|I ordered this for my parents' anniversary and they loved it. The photo quality on the wood is surprisingly clear.|Great value for the price. I've seen similar items go for double the cost.|It's okay. The color is slightly different than the picture, but still looks nice.|One of the best customized gifts I've bought online. Very hassle-free process.|Fast delivery and good quality. Can't ask for more.|The engraving is a bit lighter than I hoped, but readable. Overall a decent purchase.|So beautiful! I keep getting compliments on it.|Simple, elegant, and personalized. Just perfect.|I had a issue with my order and the support team fixed it immediately. Great service.|Product feels very sturdy and durable. Good job.|The personalization makes it so unique. I'm buying one for myself now.|Quick turnaround time for a custom item. Very impressed.|Love it! Will recommend to all my friends." %}
  {% assign bodies = bodies_string | split: "|" %}
  
  {% assign product_id_num = product.id | default: 123456789 %}
  {% assign random_seed = product_id_num | modulo: 1000 %}
  
  {% assign rating_mod = random_seed | modulo: 6 %}
  {% case rating_mod %}
    {% when 0 %}{% assign rating_score = 4.8 %}
    {% when 1 %}{% assign rating_score = 4.9 %}
    {% when 2 %}{% assign rating_score = 5.0 %}
    {% when 3 %}{% assign rating_score = 4.7 %}
    {% when 4 %}{% assign rating_score = 4.6 %}
    {% else %}{% assign rating_score = 4.9 %}
  {% endcase %}
  
  {% assign count_mod = random_seed | modulo: 125 %}
  {% assign review_count = 25 | plus: count_mod %}
  
  {% assign num_reviews_to_show = random_seed | modulo: 3 | plus: 3 %}
{% endif %}

<style>
  .custom-reviews-container {
    margin-top: 20px;
    font-family: var(--g-font-2, sans-serif);
  }
  .custom-review-summary {
    display: flex;
    align-items: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 1px solid #eee;
  }
  .custom-rating-score {
    font-size: 48px;
    font-weight: bold;
    margin-right: 20px;
    line-height: 1;
  }
  .custom-rating-stars {
    color: #f3c621;
    font-size: 20px;
    margin-bottom: 5px;
  }
  .custom-rating-count {
    color: #666;
    font-size: 14px;
  }
  .custom-review-item {
    padding: 20px 0;
    border-bottom: 1px solid #f5f5f5;
  }
  .custom-review-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
  }
  .custom-review-author {
    font-weight: bold;
    font-size: 16px;
  }
  .custom-review-date {
    color: #999;
    font-size: 14px;
  }
  .custom-review-stars {
    color: #f3c621;
    font-size: 14px;
    margin-bottom: 8px;
  }
  .custom-review-body {
    font-size: 15px;
    line-height: 1.6;
    color: #333;
    margin-bottom: 10px;
  }
  .custom-review-images {
    display: flex;
    gap: 10px;
    margin-top: 10px;
  }
  .custom-review-image {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 4px;
    cursor: pointer;
    border: 1px solid #eee;
  }
  .verified-badge {
    display: inline-flex;
    align-items: center;
    color: #28a745;
    font-size: 12px;
    margin-left: 8px;
  }
  .verified-badge svg {
    width: 14px;
    height: 14px;
    margin-right: 4px;
    fill: currentColor;
  }
  
  /* Standard Shopify Reviews Compatibility */
  .spr-container { padding: 0 !important; border: none !important; }
  .spr-header { margin-bottom: 30px !important; }
  .spr-review { border: none !important; border-bottom: 1px solid #f5f5f5 !important; padding: 20px 0 !important; margin: 0 !important; }
  .spr-review-header-title { font-family: var(--g-font-2, sans-serif) !important; font-weight: bold !important; font-size: 16px !important; margin-bottom: 5px !important; }
  .spr-review-header-byline { font-family: var(--g-font-2, sans-serif) !important; font-size: 14px !important; color: #999 !important; opacity: 1 !important; font-style: normal !important; }
  .spr-review-content-body { font-family: var(--g-font-2, sans-serif) !important; font-size: 15px !important; line-height: 1.6 !important; color: #333 !important; }
  .spr-icon { color: #f3c621 !important; font-size: 14px !important; }
  /* Hide default Shopify Review Summary elements to avoid 0/5 conflict */
  .spr-header-title,
  .spr-summary-caption,
  .spr-starrating {
    display: none !important;
  }
</style>

<div class="custom-reviews-container">
  <div class="custom-review-summary">
    <div class="custom-rating-score">{{ rating_score }}</div>
    <div>
      <div class="custom-rating-stars">
        {% if rating_score >= 4.8 %}★★★★★{% else %}★★★★☆{% endif %}
      </div>
      <div class="custom-rating-count">Based on {{ review_count }} reviews</div>
    </div>
  </div>

  <div class="custom-reviews-list">
    {% if use_metafield %}
      {% for review in reviews_metafield %}
        <div class="custom-review-item">
          <div class="custom-review-header">
            <div class="custom-review-author">
              {{ review.name }}
              <span class="verified-badge">
                <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                Verified Buyer
              </span>
            </div>
            <div class="custom-review-date">{{ review.date }}</div>
          </div>
          <div class="custom-review-stars">
            {% case review.rating %}
              {% when 5 %}★★★★★
              {% when 4 %}★★★★☆
              {% when 3 %}★★★☆☆
              {% when 2 %}★★☆☆☆
              {% else %}★☆☆☆☆
            {% endcase %}
          </div>
          <div class="custom-review-body">
            <strong>{{ review.title }}</strong><br>
            {{ review.body }}
          </div>
          {% if review.image %}
            <div class="custom-review-images">
              <img src="{{ review.image }}" class="custom-review-image" alt="Review Image">
            </div>
          {% endif %}
        </div>
      {% endfor %}
    {% else %}
      {% for i in (1..num_reviews_to_show) %}
        {% comment %} Pseudo-random index selection {% endcomment %}
        {% assign index_seed = random_seed | plus: i | times: 17 %}
        {% assign name_index = index_seed | modulo: names.size %}
        {% assign title_index = index_seed | modulo: titles.size %}
        {% assign body_index = index_seed | modulo: bodies.size %}
        
        {% comment %} Date logic: 1 to 30 days ago {% endcomment %}
        {% assign days_ago = index_seed | modulo: 30 | plus: 1 %}
        
        <div class="custom-review-item">
          <div class="custom-review-header">
            <div class="custom-review-author">
              {{ names[name_index] }}
              <span class="verified-badge">
                <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                Verified Buyer
              </span>
            </div>
            <div class="custom-review-date">{{ days_ago }} {% if days_ago == 1 %}day{% else %}days{% endif %} ago</div>
          </div>
          <div class="custom-review-stars">★★★★★</div>
          <div class="custom-review-body">
            <strong>{{ titles[title_index] }}</strong><br>
            {{ bodies[body_index] }}
          </div>
        </div>
      {% endfor %}
    {% endif %}
  </div>
</div>